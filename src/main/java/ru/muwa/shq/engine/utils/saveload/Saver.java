package ru.muwa.shq.engine.utils.saveload;

import com.fasterxml.jackson.databind.ObjectMapper;
import ru.muwa.shq.engine.Game;
import ru.muwa.shq.entities.Item;
import ru.muwa.shq.entities.Level;
import ru.muwa.shq.entities.LevelSkeleton;
import ru.muwa.shq.entities.Player;
import ru.muwa.shq.story.Dialogue;

import java.io.File;
import java.io.IOException;
import java.net.URISyntaxException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.HashMap;

/**
 * Класс осуществляющий сохранение игры.
 */
public class Saver {
    private static String PATH = "\\shq_save";//"C:\\Program Files\\shq_save";

    public static void work()
    {
        if(save()) System.out.println("Игра сохранена успешно");
        else System.out.println("Ошибка при сохранении");


    }
    //Метод сохранения игры. Возвращает статус операции (успех / не успех)
    public static boolean save(){
        try {
        // Получаем путь к папке, где находится JAR-файл
        Path jarPath = Paths.get(Saver.class.getProtectionDomain().getCodeSource().getLocation().toURI()).getParent();
        File saveDirectory = new File(jarPath.toFile(), "shq_save");
        PATH = saveDirectory.getPath();

        // Создаем папку, если она не существует
        if (!saveDirectory.exists()) {
            saveDirectory.mkdirs();
        }
        ObjectMapper objectMapper = new ObjectMapper();

            // Записываем вещи игрока
            objectMapper.writeValue(new File(PATH + "\\items.json"), Game.player.items);
            // Записываем уровни
            for(var l : Level.repo.values())
            {
                var skeleton = new LevelSkeleton(l);
                objectMapper.writeValue(new File(PATH + "\\level_"+l.id+".json"),skeleton);
            }
            // Записываем квесты
            objectMapper.writeValue(new File(PATH + "\\quests.json"),Game.player.quests);

            objectMapper.writeValue(new File(PATH + "\\player.json" ), new PlayerData(Game.player));

            //Сохраняем диалоги
            objectMapper.writeValue(new File(PATH + "\\mom_dialogues.json"), Dialogue.mom);
            objectMapper.writeValue(new File(PATH + "\\hach_dialogues.json"), Dialogue.hach);
            objectMapper.writeValue(new File(PATH + "\\hacker_dialogues.json"), Dialogue.hacker);



            return true;
        } catch (Exception e){
            // Если что-то пошло не так
            System.out.println(e.getMessage());
            e.printStackTrace();
            return false;
        }


    }


}
